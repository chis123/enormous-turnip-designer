/*!
 * Brick SpreadSheet
 * A JavaScript spreedsheet designer based on Handsontable.
 * 
 * @version v0.5.0
 * @author zhangqiang
 * @license MIT
 * 
 * Build on: "2017-07-06T07:09:47.478Z"
 * -  handsontable-lnsoft version: 0.32.0
 * -            formulajs version: 1.0.8
 * -               moment version: 2.13.0
 * -               numbro version: 1.11.0
 * -              pikaday version: 1.4.0
 * -        zeroclipboard version: 2.3.0
 */
!function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(require,module,exports){"use strict";function e(){this.name="SpreadSheetError",this.message="发生了错误"}Object.defineProperty(exports,"__esModule",{value:!0}),e.prototype=new Error,e.prototype.constructor=e,e.prototype.toString=function(){return this.name+" => "+this.message},exports.SpreadSheetError=e},{}],2:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}var t=require("./settings"),n=require("./core"),r=e(n),o=require("./polyfill"),i=e(o),s=require("./plugins/Plugin"),a=require("./plugins/persistent/Persistent"),l=e(a);r.default.globalSettings=t.globalSettings,r.default.defaultSettings=t.defaultSettings,r.default.version="0.5.0",r.default.plugins={Plugin:s.Plugin,registerPlugin:s.registerPlugin},(0,s.registerPlugin)("persistent",l.default),window.BrickSpreadSheet=r.default,window._UIProvider={},(0,i.default)(window)},{"./core":3,"./plugins/Plugin":18,"./plugins/persistent/Persistent":20,"./polyfill":22,"./settings":23}],3:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=require("./designer/Frame"),s=e(i),a=require("./designer/Workbook"),l=e(a),u=require("./utils/common"),c=require("./plugins/Plugin"),h=require("./utils/Emitter"),f=e(h),d=1,p=function(e){function i(e,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t(this,i);var a=n(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return a.rootElement=e,a.getUserSettings(r),a.settings={},(0,u.extend)(a.settings,i.defaultSettings),(0,u.extend)(a.settings,a.userSettings),a.id=a.settings.id||a.getId(),a.displayMode=o,a._initPlugin(),a.frame=new s.default(a,a.settings.frame),a.workbook=new l.default(a,a.settings.workbook),a._enablePlugin(),a}return r(i,e),o(i,[{key:"getId",value:function(){return this.id||i.globalSettings.idPrefix+d++ +"-"+(0,u.randomString)()}},{key:"getRootElement",value:function(){return this.rootElement}},{key:"getDisplayMode",value:function(){return this.displayMode}},{key:"getUserSettings",value:function(e){return this.userSettings?this.userSettings:(e&&"string"==typeof e?this.userSettings=JSON.parse(e):this.userSettings=e,this.userSettings)}},{key:"getSettings",value:function(){return this.settings}},{key:"getExchangeData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.workbook._getExchange(),n=this.frame._getExchange(),r={workbook:t,frame:n,id:this.getId()};return e?r:JSON.stringify(r)}},{key:"getWorkbookInstance",value:function(){return this.workbook}},{key:"getFrameInstance",value:function(){return this.frame}},{key:"_initPlugin",value:function(){var e=this;this.plugins=new Map,(0,c.getAllPlugins)().forEach(function(t){var n=new t(e);(0,c.validatePlugin)(n),e.plugins.set(n.__name__,n)})}},{key:"_enablePlugin",value:function(){this.plugins.forEach(function(e){e.isEnable()&&e.enable()})}}]),i}(f.default);exports.default=p},{"./designer/Frame":5,"./designer/Workbook":9,"./plugins/Plugin":18,"./utils/Emitter":24,"./utils/common":25}],4:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function n(t,r){e(this,n),this.initialConfig=t,this.sheet=r}return t(n,[{key:"translate",value:function(){for(var e={},t=Object.getPrototypeOf(this),n=Object.getOwnPropertyNames(t),r=0;r<n.length;++r)n[r].startsWith("_trans")&&this[n[r]].call(this,e);return e}},{key:"initSheetState",value:function(){for(var e=Object.getPrototypeOf(this),t=Object.getOwnPropertyNames(e),n=0;n<t.length;++n)t[n].startsWith("_init")&&this[t[n]].call(this)}},{key:"_transCell",value:function(e){var t=this.initialConfig.cellMetas;if(t){e.cell=[];for(var n=0;n<t.length;++n)for(var r=t[n],o=0;o<r.length;++o){var i=r[o];if(i){var s={};if(s.row=i.row,s.col=i.col,i.dataType){for(var a in i.dataType)i.dataType.hasOwnProperty(a)&&(s[a]=i.dataType[a]);s.type=i.dataType.typeName,delete s.typeName}if(i.styles){if(i.styles.alignments){var l=i.styles.alignments.join(" ht");s.className=s.className?s.className+=" ht"+l:"ht"+l}i.styles.fontFamily&&(s._style_fontFamily=i.styles.fontFamily),i.styles.fontSize&&(s._style_fontSize=i.styles.fontSize),i.styles.color&&(s._style_color=i.styles.color),i.styles.backgroundColor&&(s._style_backgroundColor=i.styles.backgroundColor),i.styles.fontStyle&&(s.className=s.className?s.className+=" ssd-font-"+i.styles.fontStyle:"ssd-font-"+i.styles.fontStyle),i.styles.fontWeight&&(s.className=s.className?s.className+=" ssd-font-bold":"ssd-font-bold"),i.styles.textDecoration&&(s.className=s.className?s.className+=" ssd-font-underline":"ssd-font-underline")}e.cell.push(s)}}}}},{key:"_transData",value:function(e){var t=this.initialConfig.data;t&&(e.minRows=this.sheet.initRows,e.minCols=this.sheet.initCols,e.data=t)}},{key:"_transColWidths",value:function(e){var t=this.initialConfig.colWidths;t&&(e.colWidths=t)}},{key:"_transRowHeights",value:function(e){var t=this.initialConfig.rowHeights;t&&(e.rowHeights=t)}},{key:"_transBorders",value:function(e){var t=this.initialConfig.borders;t&&(e.customBorders=t)}},{key:"_transMergeCells",value:function(e){var t=this.initialConfig.mergeCells;t&&(e.mergeCells=t)}},{key:"_initSelection",value:function(){var e=this.initialConfig.selection;e?this.sheet.select(e.row,e.col,e.endRow,e.endCol):this.sheet.select(0,0)}}]),n}();exports.default=n},{}],5:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=require("./frame/ContextMenu"),o=e(r),i=function(){function e(n,r){t(this,e),this.spreadSheet=n,this.contextMenu=new o.default(n)}return n(e,[{key:"_getExchange",value:function(){}}]),e}();exports.default=i},{"./frame/ContextMenu":12}],6:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},s=require("../utils/common.js"),a=require("./ConfigTranslator.js"),l=e(a),u=function(e){function a(e,r,o,i){t(this,a);var u={},c=new l.default(r,i),h=c.translate(),f=i.workbook.spreadSheet.getFrameInstance(),d=i.workbook.spreadSheet.getDisplayMode(),p=f.contextMenu.menuItems,g={};g.items=f.contextMenu.getMenuItems4HotTable(),g.callback=function(e){return function(t,n){if(p.has(t)){var r=p.get(t);r.handler&&r.handler.call(this,e,n.start,n.end,n)}}}(i),a._preference.contextMenu=g,(0,s.extend)(u,a._preference),(0,s.extend)(u,h),(0,s.extend)(u,o),d&&(u.colHeaders=!1,u.rowHeaders=!1);var v=n(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,u));return v._translator=c,Handsontable.hooks.add("beforeRenderer",function(e,t,n,r,o,i){e.style.color=i._style_color||"",e.style.fontFamily=i._style_fontFamily||"",e.style.fontSize=i._style_fontSize||"",e.style.backgroundColor=i._style_backgroundColor||""},v),["afterSelectionEnd"].forEach(function(e){Handsontable.hooks.add(e,function(){var t=[];t.push(e),t.push(i),t.push.apply(t,[].slice.call(arguments));var n=i.workbook.spreadSheet;n.emit.apply(n,t)},v)}),v}return r(a,e),o(a,[{key:"destroy",value:function(){i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"destroy",this).call(this),delete this._translator}}]),a}(Handsontable);u._preference={outsideClickDeselects:!1,contextMenu:!0,rowHeaders:!0,colHeaders:!0,manualColumnResize:!0,manualRowResize:!0,tableClassName:"ssd-handsontable",customBorders:!0,xFormulas:!0},exports.default=u},{"../utils/common.js":25,"./ConfigTranslator.js":4}],7:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=require("./HotTableAdaptor"),s=e(i),a=require("./SheetError"),l=require("./ext/Sheet_exchange"),u=require("./ext/Sheet_helper"),c=require("../utils/common"),h=require("../utils/Emitter"),f=e(h),d=150,p=50,g=(0,u.SheetHelper)((0,l.Exchange)(f.default)),v=function(e){function i(e,r){t(this,i);var o=n(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.workbook=e,o.$$view=e.$$view,o.settings=r,o.sheetName=r.name,o.initRows=d,o.initCols=p,o.fx={},o._render(),o}return r(i,e),o(i,[{key:"_render",value:function(){this.$$view.appendTab(this.sheetName);var e=this.$$view._hotTables.get(this.sheetName),t=e.container,n=e.width,r=e.height;this.handsontable=new s.default(t,this.settings,{width:n,height:r,readOnly:this.workbook.spreadSheet.getDisplayMode(),startRows:this.initRows,startCols:this.initCols,_isHotTableAdaptor:!0,_sheet:this},this),this.handsontable._translator.initSheetState(),this.$$view.hideContent(this.getName())}},{key:"getName",value:function(){return this.sheetName}},{key:"active",value:function(){this.workbook.activeSheet=this.getName(),this.$$view.activeTab(this.getName()),this.handsontable.render()}},{key:"isActive",value:function(){return this.workbook.activeSheet===this.getName()}},{key:"close",value:function(){this.workbook.closeSheet(this.getName())}},{key:"destroy",value:function(){this.handsontable.destroy(),this.workbook.sheets.delete(this.getName()),delete this.workbook,delete this.$$view}},{key:"rename",value:function(e){this.workbook.renameSheet(this.getName(),e)}},{key:"select",value:function(e,t,n,r){n=n||e,r=r||t,this.handsontable.selectCell(e,t,n,r,!1)}},{key:"getSelection",value:function(){var e=this.handsontable.getSelected();return{row:e[0],col:e[1],endRow:e[2],endCol:e[3]}}},{key:"mergeCells",value:function e(t,n,r,o){for(var i=0,s=[],e=this.handsontable.getSettings().mergeCells,l=[t,n,t+r-1,n+o-1],u=e.length;u;--u){var h=e[u-1],f=[h.row,h.col,h.row+h.rowspan-1,h.col+h.colspan-1];if(c.Coordinate.isEqual(l,f)){i=1;break}if(c.Coordinate.isSubset(l,f)){i=2;break}c.Coordinate.isSuperset(l,f)?(s.push(u-1),i=3):c.Coordinate.intersection(l,f)&&(i=4)}if(0===i||3===i){if(3===i)for(var d=0;d<s.length;++d)e.splice(s[d],1);e=e||[],e.push({row:t,col:n,rowspan:r,colspan:o}),this.handsontable.updateSettings({mergeCells:e})}else if(2===i||4===i)throw new a.SheetError("给定的合并区域不合法: ["+t+", "+n+", "+r+", "+o+"]")}},{key:"unMergeCells",value:function(e,t,n,r){var o=this.handsontable.getSettings().mergeCells,i=[];if(o&&o.length)for(var s=0;s<o.length;++s)c.Coordinate.isSubset([o[s].row,o[s].col,o[s].row+o[s].rowspan-1,o[s].col+o[s].colspan-1],[e,t,e+n-1,t+r-1])||i.push(o[s]);this.handsontable.updateSettings({mergeCells:0!==i.length&&i})}},{key:"spliceClass",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=this;this._walkonCellMetas(e,function(e,n,o){return{className:(i._removeFormerClass(o.className,r)+" "+t).trim()}},{className:t})}},{key:"setFontBold",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();e?this.spliceClass(t,"ssd-font-bold","ssd-font-bold"):this.spliceClass(t,"","ssd-font-bold"),this.handsontable.render()}},{key:"setFontItalic",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();e?this.spliceClass(t,"ssd-font-italic","ssd-font-italic"):this.spliceClass(t,"","ssd-font-italic"),this.handsontable.render()}},{key:"setFontUnderline",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();e?this.spliceClass(t,"ssd-font-underline","ssd-font-underline"):this.spliceClass(t,"","ssd-font-underline"),this.handsontable.render()}},{key:"setFontColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();this._walkonCellMetas(t,function(){return{_style_color:e}},{_style_color:e}),this.handsontable.render()}},{key:"setFontFamily",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();this._walkonCellMetas(t,function(){return{_style_fontFamily:e}},{_style_fontFamily:e}),this.handsontable.render()}},{key:"setFontSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();this._walkonCellMetas(t,function(){return{_style_fontSize:e}},{_style_fontSize:e}),this.handsontable.render()}},{key:"setBackgroundColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelection();this._walkonCellMetas(t,function(){return{_style_backgroundColor:e}},{_style_backgroundColor:e}),this.handsontable.render()}},{key:"setBorder",value:function(e,t,n,r,o){var i={range:e,top:t};i.right=n||t,i.bottom=r||t,i.left=o||i.right;var s=this.handsontable.getSettings().customBorders;s===!0&&(s=[]),s.push(i),this.handsontable.updateSettings({customBorders:s})}},{key:"setDataFormat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getSelection();this._walkonCellMetas(n,function(n,r,o){var i=o.type;return"date"===i?(delete o.dateFormat,delete o.defaultDate,delete o.correctFormat):"numeric"===i&&(delete o.format,delete o.language),o.type=e,delete o.renderer,delete o.editor,delete o.validator,(0,c.extend)(o,t)},{type:e}),this.handsontable.render()}}]),i}(g);exports.default=v},{"../utils/Emitter":24,"../utils/common":25,"./HotTableAdaptor":6,"./SheetError":8,"./ext/Sheet_exchange":10,"./ext/Sheet_helper":11}],8:[function(require,module,exports){"use strict";function e(e){this.name="SheetError",this.message=e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SheetError=e;var t=require("../SpreadSheetError");e.prototype=new t.SpreadSheetError,e.prototype.constructor=e},{"../SpreadSheetError":1}],9:[function(require,module,exports){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=require("./views/Tabs"),i=e(o),s=require("./Sheet"),a=e(s),l=require("./SheetError"),u=require("../utils/dataStructure"),c=require("../utils/common"),h=require("../settings"),f=h.globalSettings.sheet.sheetName,d=function(){function e(n,r){var o=this;t(this,e),this.spreadSheet=n,this.sheets=new u.CaseInsensitiveMap,this.settings=r,this._initSettings(r),this.$$view=new i.default(this),r.sheets.forEach(function(e){return o.createSheet(e)});var s=this.getSheet(this.activeSheet);if(!s)throw new l.SheetError("指定的 activeSheet 不存在: "+this.activeSheet);s.active()}return r(e,[{key:"_initSettings",value:function(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;++n)"sheets"!==t[n]&&(this[t[n]]=e[t[n]])}},{key:"getSettings",value:function(){return this.spreadSheet.getSettings()}},{key:"getId",value:function(){return this.id||(this.id=this.spreadSheet.getId()+h.globalSettings.idSuffix4Workbook)}},{key:"getSheet",value:function(e){return this.sheets.get(e)}},{key:"getSheets",value:function(){return this.sheets}},{key:"getSheetNames",value:function(){return this.sheets.keys()}},{key:"isSheetExist",value:function(e,t){return t?this.sheets.hasExact(e):this.sheets.has(e)}},{key:"_getAutoSheetIndex",value:function(){return this.$$autoSheetIndex||(this.$$autoSheetIndex=0),++this.$$autoSheetIndex}},{key:"_getAutoSheetName",value:function(){var e=h.globalSettings.sheet.autoPrefix+"",t=e+this._getAutoSheetIndex();return this.isSheetExist(t)?this._getAutoSheetName():t}},{key:"getActiveSheet",value:function(){return this.sheets.get(this.activeSheet)}},{key:"createSheet",value:function(e){e?this._validateSheetName(e.name):(e={},e.name=this._getAutoSheetName());var t=new a.default(this,e);return this.sheets.set(e.name,t),t}},{key:"destroySheet",value:function(e){"string"==typeof e&&(e=this.getSheet(e)),e.destroy()}},{key:"renameSheet",value:function(e,t){var n=this.getSheet(e);if(!n)throw new l.SheetError('工作表 "'+e+'" 不存在');e!==t?(this._validateSheetName(t,(0,c.upperCase)(e)===(0,c.upperCase)(t)),n.sheetName=t,this.activeSheet===e&&(this.activeSheet=t),this.getSheets().delete(e),this.getSheets().set(t,n),this.$$view.tabRename(e,t)):this.$$view.tabRenameCancel(e,t)}},{key:"closeSheet",value:function(e){var t=this.getSheet(e);if(!t)throw new l.SheetError('无法关闭不存在的工作表 "'+e+'" 。');if(1===this.sheets.size())throw new l.SheetError('无法关闭仅有的一个工作表 "'+e+'" 。');if(t.isActive()){var n=!0,r=!1,o=void 0;try{for(var i,s=this.sheets.keys()[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var a=i.value;if(a&&a!==e){this.activeSheet=a,this.getSheet(a).active();break}}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}this.sheets.delete(e),this.$$view.removeTab(e),this.destroySheet(t)}},{key:"active",value:function(){this.getActiveSheet().active()}},{key:"activeSheet",value:function(e){var t=this.getSheet(e);t&&t.active()}},{key:"_validateSheetName",value:function(e,t){if(!e)throw new l.SheetError("工作表的名称不能为空");if(f.test(e))throw new l.SheetError('工作表 "'+e+'" 包含非法字符');if(this.isSheetExist(e,t))throw new l.SheetError('工作表 "'+e+'" 已存在')}},{key:"_getExchange",value:function(){var e=[],t=!0,r=!1,o=void 0;try{for(var i,s=this.getSheets().toMap()[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=n(i.value,2),l=a[1];l&&e.push(l._getExchange())}}catch(e){r=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}return{activeSheet:this.activeSheet,sheets:e}}}]),e}();exports.default=d},{"../settings":23,"../utils/common":25,"../utils/dataStructure":26,"./Sheet":7,"./SheetError":8,"./views/Tabs":16}],10:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();exports.Exchange=function(o){return function(o){function i(){return e(this,i),t(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return n(i,o),r(i,[{key:"_getExchange",value:function(){var e=this._getDataMeta(),t=e.data,n=e.cells,r=this._getSizeEx(),o=r.heights,i=r.widths,s=this.handsontable.getSettings().mergeCells;return s===!1&&(s=null),{name:this.getName(),selection:this.getSelection(),data:t.length?t:[]._,rowHeights:o,colWidths:i,mergeCells:s,cellMetas:n}}},{key:"_getStylesEx",value:function(e){var t={},n=this._getAlignmentEx(e.className);return n&&(t.alignments=n),this._getFontEx(e,t),this._getBgColorEx(e,t),t}},{key:"_getBgColorEx",value:function(e,t){e._style_backgroundColor&&(t.backgroundColor=e._style_backgroundColor)}},{key:"_getFontEx",value:function(e,t){e._style_fontFamily&&(t.fontFamily=e._style_fontFamily),e._style_fontSize&&(t.fontSize=e._style_fontSize),e.className&&e.className.contains("ssd-font-italic")&&(t.fontStyle="italic"),e.className&&e.className.contains("ssd-font-bold")&&(t.fontWeight="bold"),e.className&&e.className.contains("ssd-font-underline")&&(t.textDecoration="underline"),e._style_color&&(t.color=e._style_color)}},{key:"_getAlignmentEx",value:function(e){var t=[];return e&&(e.contains("htLeft")&&t.push("Left"),e.contains("htCenter")&&t.push("Center"),e.contains("htRight")&&t.push("Right"),e.contains("htJustify")&&t.push("Justify"),e.contains("htTop")&&t.push("Top"),e.contains("htMiddle")&&t.push("Middle"),e.contains("htBottom")&&t.push("Bottom")),!!t.length&&t}},{key:"_getSizeEx",value:function(){for(var e=this.handsontable,t=Math.max(e.countCols()-e.countEmptyCols(!0),20),n=Math.max(e.countRows()-e.countEmptyRows(!0),50),r=[],o=[],i=0;i<n;++i){var s=e.getRowHeight(i);0!==i||s||(s=24),r.push(s)}for(var a=0;a<t;++a)o.push(e.getColWidth(a));return{heights:r,widths:o}}},{key:"_getDataMeta",value:function(){for(var e=this.handsontable,t=e.countCols()-e.countEmptyCols(!0),n=e.countRows()-e.countEmptyRows(!0),r=[],o=[],i=0;i<n;++i){for(var s=[],a=[],l=0;l<t;++l){var u=e.getSourceDataAtCell(i,l),c=e.getCellMeta(i,l),h=e.getDataAtCell(i,l),f={};f.row=i,f.col=l,f.isFormula=!(!u||"="!==(u+"").charAt(0)),f.sourceValue=u,f.value=h,function(e,t){for(var n in e)return void(t.styles=e)}(this._getStylesEx(c),f),this._getDataType(c,f),s.push(u),a.push(f)}r.push(s),o.push(a)}return{data:r,cells:o}}},{key:"_getBordersEx",value:function(){}},{key:"_getDataType",value:function(e,t){var n=e.type;t.dataType={},t.dataType.typeName=n,"date"===n?(t.dataType.dateFormat=e.dateFormat,e.defaultDate&&(t.dataType.defaultDate=e.defaultDate),e.correctFormat&&(t.dataType.correctFormat=e.correctFormat)):"numeric"===n&&(t.dataType.format=e.format,e.language&&(t.dataType.language=e.language))}}]),i}(o)}},{}],11:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();exports.SheetHelper=function(o){return function(o){function i(){return e(this,i),t(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return n(i,o),r(i,[{key:"_defaultSelection",value:function(e){return e.row>e.endRow&&(e.row=[e.endRow,e.endRow=e.row][0]),e.col>e.endCol&&(e.col=[e.endCol,e.endCol=e.col][0]),{startRow:e.row,endRow:e.endRow||e.row,startCol:e.col,endCol:e.endCol||e.col}}},{key:"_removeFormerClass",value:function(e){if(!e)return"";for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=!0,i=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;e=e.split(u).join("")}}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}return e.trim()}},{key:"_walkonCellMetas",value:function(e,t,n){for(var r=this._defaultSelection(e),o=r.startRow,i=r.endRow,s=r.startCol,a=r.endCol,l=o;l<=i;++l)for(var u=s;u<=a;++u){var c=this.handsontable.getCellMeta(l,u);if(c){var h=t.call(this,l,u,c);h&&this.handsontable.setCellMetaObject(l,u,h)}else n&&this.handsontable.setCellMetaObject(l,u,n)}}},{key:"_walkonCells",value:function(e,t){for(var n=this._defaultSelection(e),r=n.startRow,o=n.endRow,i=n.startCol,s=n.endCol,a=r;a<=o;++a)for(var l=i;l<=s;++l){var u=this.handsontable.getCell(a,l,!0);u&&t.call(this,a,l,u)}}},{key:"_walkonSelection",value:function(e,t){for(var n=this._defaultSelection(e),r=n.startRow,o=n.endRow,i=n.startCol,s=n.endCol,a=r;a<=o;++a)for(var l=i;l<=s;++l)t.call(this,a,l)}}]),i}(o)}},{}],12:[function(require,module,exports){"use strict";function e(e){this.spreadSheet=e,this.menuItems=new Map,this._init()}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./ContextMenu_alignment"),n=require("./ContextMenu_mergeCells"),r=require("./ContextMenu_rowOrColumnResize");exports.default=e,e.prototype.register=function(e,t,n){this.menuItems.set(e,{config:t,handler:n})},e.prototype.getMenuItems4HotTable=function(){var e=this;return this._hotTableItems||(this._hotTableItems={},this.menuItems.forEach(function(t,n){var r=t.config;return e._hotTableItems[n]=r})),this._hotTableItems},e.prototype._init=function(){var e="---------";this.register("row_above",{name:"上方插入一行",disabled:function(){return!1}}),this.register("row_below",{name:"下方插入一行"}),this.register("col_left",{name:"左侧插入一列"}),this.register("col_right",{name:"右侧插入一列"}),this.register("hsep_bt_insert",e),this.register("remove_row",{name:"删除选中行",disabled:function(){return!1}}),this.register("remove_col",{name:"删除选中列"}),this.register("hsep_bt_remove",e),this.register("alignment",(0,t.alignmentItem)()),this.register("row_resize",r.rowResize,r.rowResizeHandler),this.register("col_resize",r.colResize,r.colResizeHandler),this.register("hsep_bt_format",e),this.register("q_merge_cells",n.mergeCells,n.mergeCellsHandler),this.register("q_cancel_merge_cells",n.cancelMergeCells,n.cancelMergeCellsHandler)}},{"./ContextMenu_alignment":13,"./ContextMenu_mergeCells":14,"./ContextMenu_rowOrColumnResize":15}],13:[function(require,module,exports){"use strict";function e(){return{name:l.MENU.S5,disabled:function(){return!(this.getSelectedRange()&&!this.selection.selectedHeader.corner)},submenu:{items:[{key:"alignment:left",name:function(){var e=this,r=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htLeft")!==-1)return!0});return r?n(l.MENU.S6):l.MENU.S6},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="horizontal",s="htLeft";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:"alignment:center",name:function(){var e=this,r=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htCenter")!==-1)return!0});return r?n(l.MENU.S7):l.MENU.S7},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="horizontal",s="htCenter";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:"alignment:right",name:function(){var e=this,r=l.MENU.S8,o=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htRight")!==-1)return!0});return o&&(r=n(r)),r},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="horizontal",s="htRight";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:"alignment:justify",name:function(){var e=this,r=l.MENU.S9,o=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htJustify")!==-1)return!0});return o&&(r=n(r)),r},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="horizontal",s="htJustify";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{name:"---------"},{key:"alignment:top",name:function(){
var e=this,r=l.MENU.S10,o=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htTop")!==-1)return!0});return o&&(r=n(r)),r},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="vertical",s="htTop";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:"alignment:middle",name:function(){var e=this,r=l.MENU.S11,o=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htMiddle")!==-1)return!0});return o&&(r=n(r)),r},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="vertical",s="htMiddle";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:"alignment:bottom",name:function(){var e=this,r=l.MENU.S12,o=t(this.getSelectedRange(),function(t,n){var r=e.getCellMeta(t,n).className;if(r&&r.indexOf("htBottom")!==-1)return!0});return o&&(r=n(r)),r},callback:function(){var e=this,t=this.getSelectedRange(),n=r(t,function(t,n){return e.getCellMeta(t,n).className}),i="vertical",s="htBottom";this.runHooks("beforeCellAlignment",n,t,i,s),o(t,i,s,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1}]}}}function t(e,t){var n=!1;return e&&e.forAll(function(e,r){if(t(e,r))return n=!0,!1}),n}function n(e){return'<span class="selected">'+String.fromCharCode(10003)+"</span>"+e}function r(e,t){for(var n={},r=e.from.row;r<=e.to.row;r++)for(var o=e.from.col;o<=e.to.col;o++)n[r]||(n[r]=[]),n[r][o]=t(r,o);return n}function o(e,t,n,r){if(e.from.row===e.to.row&&e.from.col===e.to.col)i(e.from.row,e.from.col,t,n,r);else for(var o=e.from.row;o<=e.to.row;o++)for(var s=e.from.col;s<=e.to.col;s++)i(o,s,t,n,r)}function i(e,t,n,r,o){var i=o(e,t),l=r;i.className&&(l="vertical"===n?s(i.className,r):a(i.className,r)),i.className=l}function s(e,t){return e.indexOf(t)!==-1?e:(e=e.replace("htTop","").replace("htMiddle","").replace("htBottom","").replace("  ",""),e+=" "+t)}function a(e,t){return e.indexOf(t)!==-1?e:(e=e.replace("htLeft","").replace("htCenter","").replace("htRight","").replace("htJustify","").replace("  ",""),e+=" "+t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.alignmentItem=e;var l=require("../../i18n")},{"../../i18n":17}],14:[function(require,module,exports){"use strict";function e(e,t,n){e.mergeCells(t.row,t.col,n.row-t.row+1,n.col-t.col+1)}function t(e,t,n){e.unMergeCells(t.row,t.col,n.row-t.row+1,n.col-t.col+1)}function n(e){var t=this.getSettings().mergeCells;if(t&&t.length)for(var n=0;n<t.length;++n){var o=t[n],s=o.row,a=o.col,l=o.rowspan,u=o.colspan;if(i.Coordinate[e]([s,a,s+l-1,a+u-1],r(this.getSelected())))return!1}return!0}function r(e){return e[0]>e[2]&&(e[0]=[e[2],e[2]=e[0]][0]),e[1]>e[3]&&(e[1]=[e[3],e[3]=e[1]][0]),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.cancelMergeCells=exports.mergeCells=void 0;var o=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports.mergeCellsHandler=e,exports.cancelMergeCellsHandler=t;var i=require("../../utils/common"),s=require("../../i18n");exports.mergeCells={name:s.MENU.S3,disabled:function(){var e=this.getSelected(),t=o(e,4),r=t[0],i=t[1],s=t[2],a=t[3];return r===s&&i===a||!n.call(this,"isEqual")}},exports.cancelMergeCells={name:s.MENU.S4,disabled:function(){return n.call(this,"isSubset")}}},{"../../i18n":17,"../../utils/common":25}],15:[function(require,module,exports){"use strict";function e(e,t,r){var i=[]._;t.row>r.row&&(t.row=[r.row,r.row=t.row][0]);for(var s=t.row;s<=r.row;++s)if(i){if(i!==e.handsontable.getRowHeight(s)){i=!1;break}}else i=e.handsontable.getRowHeight(s);var a=i===!1?"":i||24;if(_UIProvider.prompt)_UIProvider.prompt(o.MENU.S13,a,function(o){o&&n(e,t.row,r.row,o)});else{var l=e.handsontable.getPlugin("contextMenu");l.close();var u=prompt(o.MENU.S13,a);null!==u&&n(e,t.row,r.row,u)}}function t(e,t,n){var i=[]._;t.col>n.col&&(t.col=[n.col,n.col=t.col][0]);for(var s=t.col;s<=n.col;++s)if(i){if(i!==e.handsontable.getColWidth(s)){i=!1;break}}else i=e.handsontable.getColWidth(s);var a=i===!1?"":i||50;if(_UIProvider.prompt)_UIProvider.prompt(o.MENU.S14,a,function(o){o&&r(e,t.col,n.col,o)});else{var l=e.handsontable.getPlugin("contextMenu");l.close();var u=prompt(o.MENU.S14,a);null!==u&&r(e,t.col,n.col,u)}}function n(e,t,n,r){r=numbro().unformat(r)||24;for(var o=e.handsontable.getSettings().rowHeights,i=t;i<=n;++i)o[i]=r;e.handsontable.updateSettings({rowHeights:o})}function r(e,t,n,r){r=numbro().unformat(r)||50;for(var o=e.handsontable.getSettings().colWidths,i=t;i<=n;++i)o[i]=r;e.handsontable.updateSettings({colWidths:o})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.colResize=exports.rowResize=void 0,exports.rowResizeHandler=e,exports.colResizeHandler=t;var o=require("../../i18n");exports.rowResize={name:o.MENU.S1,hidden:function(){return!this.getSelectedRange()||!this.selection.selectedHeader.rows}},exports.colResize={name:o.MENU.S2,hidden:function(){return!this.getSelectedRange()||!this.selection.selectedHeader.cols}}},{"../../i18n":17}],16:[function(require,module,exports){"use strict";function e(e){this.workbook=e,this.liItems=new r.CaseInsensitiveMap,this.sectionItems=new r.CaseInsensitiveMap,this._hotTables=new Map,this.rootElement=e.spreadSheet.getRootElement(),this.displayMode=e.spreadSheet.getDisplayMode(),this.initDOM(),this.initBox(),this.render()}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../utils/domHelper.js"),n=require("../../utils/common.js"),r=require("../../utils/dataStructure.js"),o=require("../../utils/eventHelper.js"),i=require("../../settings.js"),s=require("../../i18n"),a=require(".././SheetError"),l="current",u="ssd-tabs",c="ssd-tabs-content",h="ssd-tabs-section",f="ssd-tabs-nav",d="ssd-tabs-ul",p="ssd-tabs-li",g="ssd-tabs-fx",v=i.globalSettings.sheet.animated,y=i.globalSettings.sheet.sheetName;e.prototype.render=function(){this.rootElement.appendChild(this.TABS)},e.prototype.initDOM=function(){this.TABS=document.createElement("div"),this.CONTENT=document.createElement("div"),this.NAV=document.createElement("nav"),this.UL=document.createElement("ul"),this.TABS.classList.add(u),this.TABS.id=this.workbook.getId(),this.CONTENT.classList.add(c),this.NAV.classList.add(f),this.UL.classList.add(d),this.TABS.appendChild(this.CONTENT),this.TABS.appendChild(this.NAV),this.NAV.appendChild(this.UL),this.appendAddButton()},e.prototype.initBox=function(){var e=this.workbook.spreadSheet.getRootElement();this.width=this.workbook.width||(0,t.outerWidth)(e,!1),this.height=this.workbook.height||(0,t.outerHeight)(e,!1),this.TABS.style.width=this.width+"px",this.TABS.style.height=this.height+"px"},e.prototype.appendTab=function(e){var n=this,r=document.createElement("li"),i=this.displayMode?"":"close hairline";r.innerHTML='\n        <a href="javascript:;">\n            <span>'+e+'</span>\n            <span class="'+i+'"></span>\n        </a>\n    ',r.classList.add(p),r.setAttribute("data-sheet",e);var s=this.TABS.querySelector("."+l+"."+p);s?(0,t.insertAfter)(s,r):this.UL.appendChild(r),this.liItems.set(e,r),r.addEventListener("click",function(e){var t=this.dataset.sheet,r=n.workbook.getSheet(t);r.active(),(0,o.stopImmediatePropagation)(e)}),this.displayMode||(r.addEventListener("dblclick",function(e){n._onTabDblclick.call(n,this),(0,o.stopImmediatePropagation)(e)}),r.querySelector(".close").addEventListener("click",function(e){var t=r.dataset.sheet;try{n.workbook.closeSheet(t)}catch(e){if(!(e instanceof a.SheetError))throw e;alert(e.message)}(0,o.stopImmediatePropagation)(e)})),this.appendContent(e)},e.prototype.removeTab=function(e){var t=this.liItems.get(e);this.UL.removeChild(t),this.liItems.delete(e),this.removeContent(e)},e.prototype.appendAddButton=function(){var e=this,t=document.createElement("li"),n=this.displayMode?"&nbsp;":"+";t.innerHTML='<a href="javascript:;"><span>'+n+"</span></a>",t.classList.add(p),this.displayMode||t.classList.add("add-tab"),this.UL.appendChild(t),this.displayMode||t.addEventListener("click",function(){try{var t=e.workbook.createSheet();t.active()}catch(e){if(!(e instanceof a.SheetError))throw e;alert(e.message)}})},e.prototype._onTabDblclick=function(e){var n=this,r=e.dataset.sheet,o=e.getElementsByTagName("span")[0],i=document.createElement("input");i.setAttribute("type","text"),i.value=r,i.classList.add("editorial"),i.style.width=(0,t.outerWidth)(o)+20+"px",i.addEventListener("blur",function(){var e=n._checkTabName(r,this.value);e===!0?n.workbook.renameSheet(r,this.value):(alert(e),n.tabRenameCancel(r,this.value))}),i.addEventListener("keypress",function(e){13===e.keyCode&&this.blur()}),(0,t.empty)(o),o.appendChild(i),i.select()},e.prototype._checkTabName=function(e,t){return(0,n.isEmptyValue)(t)?s.WARNS.S1:y.test(t)?s.WARNS.S2:(0,n.upperCase)(e)===(0,n.upperCase)(t)||!this.workbook.isSheetExist(t)||s.WARNS.S3},e.prototype.tabRename=function(e,n){var r=this.liItems.get(e),o=r.getElementsByTagName("span")[0];(0,t.innerHTML)(o,n),r.dataset.sheet=n,this.liItems.set(n,r);var i=this.sectionItems.get(e);i.dataset.sheet=n,this.sectionItems.delete(e),this.sectionItems.set(n,i);var s=this.workbook.getSheet(n);s.emit("afterRename",s,e,n)},e.prototype.tabRenameCancel=function(e,n){var r=this.liItems.get(e),o=r.getElementsByTagName("span")[0];(0,t.innerHTML)(o,e);var i=this.workbook.getSheet(e);i.emit("afterRenameCancel",i,e,n)},e.prototype.appendContent=function(e){var t=document.createElement("section"),n=document.createElement("div"),r=document.createElement("div");t.setAttribute("data-sheet",e),t.appendChild(n),t.appendChild(r),t.classList.add(h),v&&t.classList.add("ssd-animated-fast"),this.CONTENT.appendChild(t),this.sectionItems.set(e,t),this.appendFx(n,e),this.appendTable(r,e)},e.prototype.removeContent=function(e){var t=this.sectionItems.get(e);this.CONTENT.removeChild(t),this.sectionItems.delete(e)},e.prototype.hideContent=function(e){var t=this.sectionItems.get(e);t.style.display="none"},e.prototype.appendFx=function(e,t){e.classList.add(g),e.classList.add(g+"-"+t)},e.prototype.appendTable=function(e,n){var r=this;this._hotTables.set(n,{container:e,width:this.width,height:function(){return r.height-(0,t.outerHeight)(r.NAV)}})},e.prototype.activeTab=function(e){var t=this.TABS.querySelector("."+l+"."+p);t&&t.classList.remove(l);var n=this.liItems.get(e);n.classList.add(l),this.activeContent(e)},e.prototype.activeContent=function(e){var t=this.sectionItems.get(e),n=this._formerActiveContent;n&&(v&&n.classList.remove("fadeIn"),n.style.display="none"),t.style.display="block",v&&t.classList.add("fadeIn"),this._formerActiveContent=t},exports.default=e},{"../../i18n":17,"../../settings.js":23,"../../utils/common.js":25,"../../utils/dataStructure.js":26,"../../utils/domHelper.js":27,"../../utils/eventHelper.js":28,".././SheetError":8}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.WARNS={S1:"工作表名不能为空白。",S2:"工作表名称包含无效字符: :  / ? * [ ]。",S3:"该名称已被使用，请尝试其他名称。"},exports.MENU={S1:"行高...",S2:"列宽...",S3:"单元格合并",S4:"取消单元格合并",S5:"对齐",S6:"左对齐",S7:"水平居中",S8:"右对齐",S9:"两端对齐",S10:"顶部对齐",S11:"垂直居中",S12:"底部对齐",S13:"请输入行高",S14:"请输入列宽"}},{}],18:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){if(!e.enable)throw new s.PluginError("插件必须包含启用方法：enable");if(!e.destroy)throw new s.PluginError("插件必须包含销毁方法：destroy")}function n(e,t){a.set(e,t),t.prototype.__name__=e}function r(e){var t=a.get(e);if(!t)throw new s.PluginError("插件不存在："+e);return t}function o(){return a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Plugin=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();exports.validatePlugin=t,exports.registerPlugin=n,exports.getPlugin=r,exports.getAllPlugins=o;var s=require("./PluginError"),a=new Map,l=function(){function t(n){e(this,t),this.spreadsheet=n,this.enabled=!1}return i(t,[{key:"_registerMethod",value:function(e){var t=this,n=this.spreadsheet.constructor.prototype;n[e]=function(){return t[e]()}}},{key:"isEnable",value:function(){return!1}},{key:"enable",value:function(){}},{key:"destroy",value:function(){}}]),t}();exports.Plugin=l},{"./PluginError":19}],19:[function(require,module,exports){"use strict";function e(e){this.name="PluginError",this.message=e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PluginError=e;var t=require("../SpreadSheetError");e.prototype=new t.SpreadSheetError,e.prototype.constructor=e},{"../SpreadSheetError":1}],20:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},i=require("../Plugin"),s=require("./Storage"),a=function(i){function a(n){e(this,a);var r=t(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n)),o=r.spreadsheet.settings;return o.persistent===!0?r.persistentKey=n.getId():r.persistentKey=o.persistent.key,r.spreadsheet.settings=s.Storage.load(r.persistentKey)||o,r._registerMethod("saveState"),r}return n(a,i),r(a,[{key:"isEnable",value:function(){return!!this.spreadsheet.getSettings().persistent}},{key:"enable",value:function(){o(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"enable",this).call(this)}},{key:"destroy",value:function(){o(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"destroy",this).call(this)}},{key:"saveState",value:function(){var e=this.spreadsheet.getExchangeData();s.Storage.save(this.persistentKey,e)}}]),a}(i.Plugin);exports.default=a},{"../Plugin":18,"./Storage":21}],21:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function n(){e(this,n)}return t(n,null,[{key:"save",value:function(e,t){"string"!=typeof t&&(t=JSON.stringify(t)),window.localStorage.setItem(n.PREFIX+e,t)}},{key:"load",value:function(e){var t=window.localStorage.getItem(n.PREFIX+e);try{return JSON.parse(t)}catch(e){return t}}},{key:"remove",value:function(e){window.localStorage[n.PREFIX+e]&&window.localStorage.removeItem(n.PREFIX+e)}},{key:"clear",value:function(){window.localStorage.clear()}}]),n}();n.PREFIX="$$brick!storage-",exports.Storage=n},{}],22:[function(require,module,exports){"use strict";function e(e){e.Number.isNaN||(e.Number.isNaN=function(e){return e!==e}),"undefined"==typeof e.String.prototype.contains&&(e.String.prototype.contains=function(e){return!!~this.indexOf(e)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),"classList"in document.documentElement||Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){function e(e){return function(n){var r=t.className.split(/\s+/g),o=r.indexOf(n);e(r,o,n),t.className=r.join(" ")}}var t=this;return{add:e(function(e,t,n){~t||e.push(n)}),remove:e(function(e,t){~t&&e.splice(t,1)}),toggle:e(function(e,t,n){~t?e.splice(t,1):e.push(n)}),contains:function(e){return!!~t.className.split(/\s+/g).indexOf(e)},item:function(e){return t.className.split(/\s+/g)[e]||null}}}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e},{}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={idPrefix:"brick-ssd-",idSuffix4Workbook:"-workbook",sheet:{autoPrefix:"工作表",sheetName:/[\\/\?\*:\[\]'"]/,animated:!1}},t={workbook:{activeSheet:"工作表1",sheets:[{name:"工作表1"}]},persistent:!0};exports.globalSettings=e,exports.defaultSettings=t},{}],24:[function(require,module,exports){"use strict";function e(){}Object.defineProperty(exports,"__esModule",{value:!0}),e.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){o.off(e,r),t.apply(n,arguments)}var o=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;for(r;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,s=r.length;i<s;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this},getGlobalEmitter:function(){var t=new e;return function(){return t}}()},exports.default=e;exports.GlobalEmitter=e.prototype.getGlobalEmitter()},{}],25:[function(require,module,exports){"use strict";function e(e,n){return t(n,function(t,n){e[n]=t}),e}function t(e,t){for(var n in e)if((!e.hasOwnProperty||e.hasOwnProperty&&e.hasOwnProperty(n))&&t(e[n],n,e)===!1)break;return e}function n(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?function(){}:a}function r(e){return e.toUpperCase()}function o(e){return e.replace(/^\S/g,function(e){return r(e)})}function i(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()}function s(e){return""===e||null===e||"undefined"==typeof e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.extend=e,exports.objectEach=t,exports.emptyFunction=n,exports.upperCase=r,exports.upperCaseFirst=o,exports.randomString=i,exports.isEmptyValue=s;var a=function(){},l=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},u=function(e,t){var n=Math.max(e[0],t[0]),r=Math.max(e[1],t[1]),o=Math.min(e[2],t[2]),i=Math.min(e[3],t[3]);return n<=o&&r<=i&&[n,r,o,i]},c=function(e){return function(t,n){var r=u(t,n);return!!r&&l(r,"sub"===e?t:n)}};exports.Coordinate={isEqual:l,intersection:u,isSubset:c("sub"),isSuperset:c("sup")}},{}],26:[function(require,module,exports){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stack=exports.CaseInsensitiveMap=void 0;var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=require("./common.js"),r=function(){function r(t){e(this,r),this._map=new Map(t),this._keys={}}return t(r,[{key:"get",value:function(e){var t=this._keys[(0,n.upperCase)(e)];return this._map.get(t)}},{key:"set",value:function(e,t){return this._keys[(0,n.upperCase)(e)]=e,this._map.set(e,t)}},{key:"has",value:function(e){return this._keys[(0,n.upperCase)(e)]}},{key:"hasExact",value:function(e){return this._map.has(e)}},{key:"clear",value:function(){return this._keys={},this._map.clear()}},{key:"delete",value:function(e){var t=this._keys[(0,n.upperCase)(e)];return delete this._keys[(0,n.upperCase)(e)],this._map.delete(t)}},{key:"entries",value:function(){return this._map.entries()}},{key:"forEach",value:function(e,t){return this._map.forEach(e,t)}},{key:"keys",value:function(){return this._map.keys()}},{key:"values",value:function(){return this._map.values()}},{key:"toMap",value:function(){return this._map}},{key:"size",value:function(){return this._map.size}}]),r}(),o=function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e(this,n),this.items=t}return t(n,[{key:"push",value:function(){var e;(e=this.items).push.apply(e,arguments)}},{key:"pop",value:function(){return this.items.pop()}},{key:"peek",value:function(){return this.isEmpty()?void 0:this.items[this.items.length-1]}},{key:"isEmpty",value:function(){return!this.size()}},{key:"size",value:function(){return this.items.length}}]),n}();exports.CaseInsensitiveMap=r,exports.Stack=o},{"./common.js":25}],27:[function(require,module,exports){"use strict";function e(e,t){if(a.test(t))e.innerHTML=t;else{var n=e.firstChild;n&&3===n.nodeType&&null===n.nextSibling?s?n.textContent=t:n.data=t:(r(e),e.appendChild(document.createTextNode(t)))}}function t(e,t){a.test(t)?e.insertAdjacentHTML("afterend",t):1===t.nodeType&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))}function n(e,t){var n;do if(e=e.parentNode,!e||!e.ownerDocument||(n=e.querySelector(t)))break;while(e);return n}function r(e){for(var t;t=e.lastChild;)try{e.removeChild(t)}catch(e){}}function o(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.offsetHeight;return n===!1?r:(t=getComputedStyle(e),r+=parseInt(t.marginTop)+parseInt(t.marginBottom))}function i(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.offsetWidth;return n===!1?r:(t=getComputedStyle(e),r+=parseInt(t.marginLeft)+parseInt(t.marginRight))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.innerHTML=e,exports.insertAfter=t,exports.closest=n,exports.empty=r,exports.outerHeight=o,exports.outerWidth=i;var s=!!document.createTextNode("test").textContent,a=/(<(.*)>|&(.*);)/},{}],28:[function(require,module,exports){"use strict";function e(e){e.isImmediatePropagationEnabled=!1,e.cancelBubble=!0}function t(e){"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.stopImmediatePropagation=e,exports.stopPropagation=t},{}]},{},[2]);